// Generated by CoffeeScript 1.7.1
(function() {
  var Booklist, Timetable,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Timetable = (function() {
    function Timetable(theweek, weekDays, theBooklist) {
      this.theweek = theweek;
      this.weekDays = weekDays;
      this.theBooklist = theBooklist;
      this.checkLessonStarting = __bind(this.checkLessonStarting, this);
      this.periodIds = ["period1", "period2", "period3", "period4", "period5", "period7", "period8", "period9", "after-school"];
      this.periodTimes = [9.0, 9 + 40 / 60, 10 + 20 / 60, 11 + 15 / 60, 11 + 55 / 60, 13 + 15 / 60, 13 + 55 / 60, 14 + 35 / 60, 15 + 15 / 60];
    }

    Timetable.prototype.setDay = function(dayIdx) {
      var dayInfo, i, subject, _i, _len;
      this.dayIdx = dayIdx;
      dayInfo = this.theweek[dayIdx];
      for (i = _i = 0, _len = dayInfo.length; _i < _len; i = ++_i) {
        subject = dayInfo[i];
        this.showPeriod(this.periodIds[i], this.periodIds[i + 1], subject, dayInfo[i + 1]);
      }
      $(".daytitle").text(this.weekDays[dayIdx]);
      return this.theBooklist.showbooks(dayInfo);
    };

    Timetable.prototype.nextDay = function() {
      this.dayIdx = this.dayIdx + 1;
      if (this.dayIdx === 5) {
        this.dayIdx = 4;
      }
      return this.setDay(this.dayIdx);
    };

    Timetable.prototype.prevDay = function() {
      this.dayIdx = this.dayIdx - 1;
      if (this.dayIdx === -1) {
        this.dayIdx = 0;
      }
      return this.setDay(this.dayIdx);
    };

    Timetable.prototype.showPeriod = function(id, nextId, subject, nextSubject) {
      $("#" + id).text(subject);
      if (subject === nextSubject) {
        $("#" + id).attr("class", "alt");
        $("#" + id).attr("rowspan", "2");
        return $("#" + nextId).hide();
      } else {
        $("#" + id).attr("rowspan", "1");
        $("#" + nextId).show();
        return $("#" + id).attr("class", "");
      }
    };

    Timetable.prototype.checkLessonStarting = function() {
      var curHours, curtime, differenceInTime, periodIdx, periodTime, testHours, _i, _len, _ref;
      curtime = new Date();
      curHours = curtime.getHours() + curtime.getMinutes() / 60;
      _ref = this.periodTimes;
      for (periodIdx = _i = 0, _len = _ref.length; _i < _len; periodIdx = ++_i) {
        periodTime = _ref[periodIdx];
        testHours = periodTime - 5 / 60;
        differenceInTime = Math.abs(curHours - testHours);
        if (differenceInTime < 1 / 3600) {
          this.notifyBooksNeeded(curtime, periodIdx);
        }
      }
      setTimeout(timetable.checkLessonStarting, 1 * 30 * 1000);
    };

    Timetable.prototype.notifyBooksNeeded = function(curtime, periodIdx) {
      var curday, lessonName;
      curday = curtime.getDay();
      if (curday === 0 || curday === 6) {
        return;
      }
      curday = curday - 1;
      this.setDay(curday);
      lessonName = this.theweek[curday][periodIdx];
      $(".lesson-name").text(lessonName);
      return $("#dialog-message").dialog("open");
    };

    return Timetable;

  })();

  Booklist = (function() {
    function Booklist(theweek, thebooks) {
      this.theweek = theweek;
      this.thebooks = thebooks;
    }

    Booklist.prototype.showbooks = function(dayInfo) {
      var book, i, prevSubject, subject, _i, _len, _results;
      $('#booklist').empty();
      prevSubject = "";
      _results = [];
      for (i = _i = 0, _len = dayInfo.length; _i < _len; i = ++_i) {
        subject = dayInfo[i];
        if (subject !== prevSubject) {
          prevSubject = subject;
          if (subject in this.thebooks) {
            $('#booklist').append("<div class = 'subject'> " + subject + " </div>");
            _results.push((function() {
              var _j, _len1, _ref, _results1;
              _ref = this.thebooks[subject];
              _results1 = [];
              for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
                book = _ref[_j];
                _results1.push(this.showbook(book));
              }
              return _results1;
            }).call(this));
          } else {
            _results.push(void 0);
          }
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    Booklist.prototype.showbook = function(book) {
      return $('#booklist').append("<div class = 'book'> " + book + " </div>");
    };

    return Booklist;

  })();

  $(document).ready(function() {
    var booklist, books, fridayLessons, mondayLessons, thursdayLessons, timetable, tuesdayLessons, wednesdayLessons, week, weekDayNames;
    mondayLessons = ["English", "Biology", "Biology", "Maths", "Maths", "German", "Art & Design", "Art & Design", "Free Time"];
    tuesdayLessons = ["Citizenship", "Geography", "Geography", "Physics", "Physics", "Maths", "German", "English", "Free Time"];
    wednesdayLessons = ["P & R", "P & R", "Music", "PE", "PE", "Maths", "Physics", "Physics", "Riding"];
    thursdayLessons = ["German", "Music", "Music", "English", "English", "Art & Design", "Art & Design", "Tennis", "Tennis"];
    fridayLessons = ["Geography", "Geography", "Computing", "Maths", "English", "Biology", "Biology", "German", "Free Time"];
    week = [mondayLessons, tuesdayLessons, wednesdayLessons, thursdayLessons, fridayLessons];
    weekDayNames = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
    books = {
      "English": ["Lined Paper", "Roll of Thunder, Hear My Cry", "English Folder & Booklets", "Homework"],
      "Maths": ["Jotter", "SSM R2 Textbook", "Homework"],
      "German": ["Work Jotter", "Dictionary", "ECHO 2 Workbook", "ECHO 2 Textbook", "Vocab Jotter", "Homework"],
      "Biology": ["Biology Folder", "Homework"],
      "Physics": ["Longman Physics Textbook", "Physics Jotter", "Homework"],
      "Art & Design": ["Art Jotter", "Homework"],
      "Citizenship": ["Organization Booklet", "UV Detector Beads"],
      "Geography": ["Geog Scot 1 Textbook", "Geography Jotter", "Homework"],
      "PE": ["PE Kit"],
      "P & R": ["P & R Jotter", "RME for Scotland Textbook", "Homework"],
      "Music": ["Student Music Workbook 1", "Student Music Workbook 2", "Homework"],
      "Riding": ["Helmet, Body Protector", "Boots, Chaps", "Gloves", "Change of Clothes & Jodhpurs"],
      "Tennis": ["PE Kit", "Tennis Racquet"],
      "Computing": ["Computing Folder", "Flash Drive", "Website", "Homework"]
    };
    booklist = new Booklist(week, books);
    timetable = new Timetable(week, weekDayNames, booklist);
    timetable.setDay(0);
    $("#timetable").on("swipeleft", function() {
      return timetable.nextDay();
    });
    $("#timetable").on("swiperight", function() {
      return timetable.prevDay();
    });
    $("#dialog-message").dialog({
      autoOpen: false,
      modal: true,
      buttons: {
        "Ok": function() {
          return $(this).dialog("close");
        }
      }
    });
    return timetable.checkLessonStarting();
  });

}).call(this);
